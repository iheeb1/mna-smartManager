<app-header></app-header>

<p-toast position="top-center"></p-toast>

<div class="container">
  <div class="header">
    <div class="header-actions">
      <button pButton label="تصدير" icon="pi pi-download" class="p-button-outlined export-btn"></button>
      <button pButton label="إضافة مركبة جديدة" (click)="addNewCar()" class="p-button-primary add-btn"></button>
    </div>
    <h1>قائمة المركبات</h1>
  </div>

  <div class="content-card">
    <div class="search-bar">
      <span class="p-input-icon-left search-input">
        <i class="pi pi-search"></i>
        <input 
          type="text" 
          pInputText 
          placeholder="بحث حر عن مركبة" 
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchChange($event)">
      </span>
      <button pButton icon="pi pi-filter" class="p-button-text filter-btn"></button>
      <button pButton label="تصفية" class="p-button-text filter-text-btn"></button>
    </div>

    <!-- Loading spinner -->
    <div *ngIf="loading" class="loading-container">
      <p-progressSpinner 
        styleClass="custom-spinner"
        strokeWidth="4"
        animationDuration="1s">
      </p-progressSpinner>
      <p>جاري تحميل المركبات...</p>
    </div>

    <!-- Empty state -->
    <div *ngIf="isEmpty" class="empty-state">
      <h2>لا توجد مركبات حتى الآن</h2>
      <p>ابدأ بإضافة مركبة جديدة لإدارة أسطولك</p>
    </div>

    <!-- Table with data -->
    <div *ngIf="!loading && !isEmpty">
      <div class="table-header">
        <div class="header-cell action">إجراء</div>
        <div class="header-cell status">نشط</div>
        <div class="header-cell model">نوع المركبة</div>
        <div class="header-cell plate">رقم المركبة</div>
      </div>

      <div class="table-body">
        <div class="table-row" *ngFor="let car of filteredCars">
          <div class="row-cell action">
            <button 
              pButton 
              icon="pi pi-trash" 
              class="p-button-text p-button-rounded p-button-sm delete-btn" 
              (click)="deleteCar(car)"
              [disabled]="loading">
            </button>
            <button 
              pButton 
              icon="pi pi-pencil" 
              class="p-button-text p-button-rounded p-button-sm edit-btn" 
              (click)="editCar(car)"
              [disabled]="loading">
            </button>
          </div>
          <div class="row-cell status">
            <p-inputSwitch 
              [(ngModel)]="car.isActive" 
              (onChange)="toggleActive(car)"
              [disabled]="loading">
            </p-inputSwitch>
          </div>
          <div class="row-cell model">{{ car.model }}</div>
          <div class="row-cell plate">
            <a href="#" class="plate-link" (click)="viewDetails(car, $event)">{{ car.plateNumber }}</a>
          </div>
        </div>
      </div>

      <!-- Pagination info -->
      <div class="pagination-info" *ngIf="totalCars > 0">
        <p>عرض {{ cars.length }} من أصل {{ totalCars }} مركبة</p>
      </div>
    </div>
  </div>
</div>

<app-car-form 
  [(visible)]="showDialog" 
  [carToEdit]="selectedCar"
  (onSave)="onCarSaved($event)"
  (onClose)="onDialogClose()">
</app-car-form>

<app-footer-nav></app-footer-nav>