<app-header></app-header>
<div class="mobile-hero-section">
  <div class="mobile-hero-content">
    <img src="assets/images/clients_mobile.png" alt="العملاء" class="hero-image">
    <h1 class="hero-title">العملاء</h1>
  </div>

  <div class="mobile-action-bar">
    <button class="action-btn">
      <img src="assets/icons/calendar_icon.svg" alt="التقويم">
    </button>
    <button class="action-btn filter-mobile-btn">
      <img src="assets/icons/filters_icon.svg" alt="فلتر">
    </button>
    <div class="mobile-search-input">
      <div class="search-icon">
        <img src="assets/icons/search_icon.svg" alt="بحث">
      </div>
      <input type="text" placeholder="بحث حر عن عمיל" [(ngModel)]="searchTerm"
        (ngModelChange)="onSearchChange($event)">
    </div>
  </div>
  <button class="mobile-add-btn" (click)="openMobileFabMenu()">
    <img src="assets/icons/plus_sign_icon.svg" alt="+">
  </button>
  <div class="mobile-fab-overlay" *ngIf="showMobileFabMenu" (click)="closeMobileFabMenu()">
    <!-- Fixed animation binding -->
    <div class="mobile-fab-menu" (click)="$event.stopPropagation()" @slideUp>
      <button class="fab-menu-item" (click)="addNewClientFromMobile()">
        إضافة عميل جديد
      </button>
    </div>
  </div>

  <!-- Contact Menu Overlay -->
<div class="mobile-fab-overlay" *ngIf="showContactMenu" (click)="closeContactMenu()">
  <div class="mobile-fab-menu" (click)="$event.stopPropagation()" @slideUp>

    <!-- PHONE MENU -->
    <!-- PHONE MENU -->
<ng-container *ngIf="contactMenuType === 'phone'">
  <p style="text-align:center; font-size:18px; margin-bottom:10px; color:#5A5780;">
    {{ selectedContactValue }}
  </p>

  <button class="fab-menu-item" (click)="callPhone(selectedContactValue!)">
    اتصل
  </button>

  <button class="fab-menu-item" (click)="sendSms(selectedContactValue!)">
    أرسل رسالة قصيرة
  </button>

  <button class="fab-menu-item" (click)="copyToClipboard(selectedContactValue!)">
    نسخ الرقم
  </button>
</ng-container>

<!-- EMAIL MENU -->
<ng-container *ngIf="contactMenuType === 'email'">
  <p style="text-align:center; font-size:18px; margin-bottom:10px; color:#5A5780;">
    {{ selectedContactValue }}
  </p>

  <button class="fab-menu-item" (click)="sendEmail(selectedContactValue!)">
    إرسال بريد إلكتروني
  </button>

  <button class="fab-menu-item" (click)="copyToClipboard(selectedContactValue!)">
    نسخ البريد الإلكتروني
  </button>
</ng-container>

  </div>
</div>

</div>

<p-toast position="top-center"></p-toast>

<div class="container">
  <div class="header">
    <div class="header-actions">
      <button pButton class="export-btn">
        <img src="assets/icons/export_icon.svg" alt="تصدير">
        <span>تصدير</span>
      </button>
      <button pButton class="p-button-text print-btn">
        <img src="assets/icons/print_icon.svg" alt="طباعة">
      </button>
      <button pButton label="إضافة عمיל جديد" (click)="addNewClient()" class="p-button-primary add-btn"></button>
    </div>
    <h1>العملاء</h1>
  </div>

  <div class="content-card">

    <!-- Loading spinner -->
    <div *ngIf="loading" class="loading-container">
      <p-progressSpinner styleClass="custom-spinner" strokeWidth="4" animationDuration="1s">
      </p-progressSpinner>
      <p>جارٍ تحميل العملاء...</p>
    </div>

    <!-- Empty state -->
    <div *ngIf="isEmpty" class="empty-state">
      <h2>لا يوجد عملاء بعد</h2>
      <p>ابدأ بإضافة عميل جديد لإدارة قاعدة عملائك</p>
    </div>

    <!-- Table with data -->
    <div *ngIf="!loading && !isEmpty">
      <div class="search-bar">
        <button class="filter-text-btn">تصفية</button>
        <button pButton class="filter-btn">
          <img src="assets/icons/filters_icon.svg" alt="فلتر">
        </button>
        <span class="p-input-icon-left search-input">
          <div class="search-icon">
            <img src="assets/icons/search_icon.svg" alt="بحث">
          </div>
          <input type="text" placeholder="بحث حر عن عميل" [(ngModel)]="searchTerm"
            (ngModelChange)="onSearchChange($event)">
        </span>
      </div>
      <div class="table-header">
        <div class="header-cell chevron"></div>
        <div class="header-cell discount">الخصم بالنسبة المئوية</div>
        <div class="header-cell credit-given">الائتمان الممنوح</div>
        <div class="header-cell balance">الرصيد</div>
        <div class="header-cell email">البريد الإلكتروني</div>
        <div class="header-cell phone">الهاتف</div>
        <div class="header-cell address">العنوان</div>
        <div class="header-cell name">اسم العميل</div>
      </div>

      <div class="table-body">
        <div class="table-row" *ngFor="let client of filteredClients">
          <div class="row-cell chevron" (click)="viewClientDetails(client)">
            <i class="pi pi-chevron-left"></i>
          </div>
          <div class="row-cell discount">
            <span class="discount-badge" [ngClass]="getDiscountClass(client.discount)">
              {{ client.discount }}
            </span>
          </div>
          <div class="row-cell credit-given">{{ client.creditGiven.toLocaleString() }}₪</div>
          <div class="row-cell balance">{{ client.balance }}</div>
          
          <!-- MOBILE CONTACT WRAPPER (ROW 4) -->
          <div class="row-cell contact-wrapper">
            <div class="contact-item email-item" (click)="openEmailMenu(client.email)">
              <span class="contact-value">{{ client.email }}</span>
              <span class="icon-wrapper">
                <img class="icon" src="assets/icons/contact_icon.svg" alt="mail">
              </span>
            </div>
            
            <div class="contact-item phone-item" (click)="openPhoneMenu(client.phone)">
              <span class="contact-value">{{ client.phone }}</span>
              <span class="icon-wrapper">
                <img class="icon" src="assets/icons/phone_icon.svg" alt="phone">
              </span>
            </div>
            
          </div>
          
          <!-- DESKTOP HIDDEN CELLS -->
          <div class="row-cell email">{{ client.email }}</div>
          <div class="row-cell phone">{{ client.phone }}</div>
          
          <div class="row-cell address">{{ client.address }}</div>
          
          <div class="row-cell name" (click)="navigateToClient(client)">
            <span>{{ client.name }}</span>
          </div>
        </div>
      </div>

      <!-- Pagination info -->
      <div class="pagination-info" *ngIf="totalClients > 0">
        <p>عرض {{ clients.length }} מתוך {{ totalClients }} לקוחות</p>
      </div>
    </div>
  </div>
  <app-client-form 
  [(visible)]="showDialog" 
  [clientToEdit]="selectedClient" 
  (onSave)="onClientSaved($event)"
  (onClose)="onDialogClose()">
</app-client-form>
</div>

<app-footer-nav></app-footer-nav>