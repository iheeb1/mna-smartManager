<p-dialog 
  [(visible)]="visible" 
  [modal]="true" 
  [closable]="true"
  [draggable]="false"
  [closeOnEscape]="true"
  [dismissableMask]="true"
  (onHide)="onDialogHide()"
  [baseZIndex]="10"
  [styleClass]="isMobile ? 'mobile-payment-dialog' : 'payment-dialog'"
  [position]="isMobile ? 'bottom' : 'center'"
  [style]="{width: isMobile ? '100%' : '85vw', height: isMobile ? '100vh' : '90vh'}">
  
  <!-- DESKTOP VIEW -->
  <div class="dialog-wrapper" *ngIf="!isMobile">
    <!-- Left Side - Form -->
    <div class="form-side">

      <!-- Section 1: Payment Date & Method -->
      <div class="section-block payment-details-section">
        <div class="section-header-row">
          <h3 class="section-header-title">תאריך תשלום</h3>
          <h3 class="section-header-title">אמצעי תשלום</h3>
        </div>
        
        <div class="input-row two-cols-equal">
          <div class="input-col">
            <p-calendar 
              [(ngModel)]="formData.paymentDate" 
              dateFormat="dd/mm/yy"
              [showIcon]="true"
              placeholder="בחר תאריך">
            </p-calendar>
          </div>
          <div class="input-col">
            <p-dropdown 
              [(ngModel)]="formData.paymentMethod"
              [options]="paymentMethodOptions" 
              placeholder="העברה בנקאית">
            </p-dropdown>
          </div>
        </div>

        <button 
          pButton 
          type="button" 
          label="+ הוסף אמצעי תשלום"
          class="add-payment-method-btn"
          (click)="addPaymentMethod()">
        </button>
      </div>

      <div class="line-divider"></div>

      <!-- Section 2: Bank Transfer Details -->
      <div class="section-block transfer-details-section">
        <div class="header-row">
          <h3 class="section-title">פרטי ההעברה</h3>
        </div>

        <div class="labels-row">
          <span class="field-label">סכום</span>
          <span class="field-label">אסמכתא</span>
          <span class="field-label">מספר חשבון</span>
          <span class="field-label">מספר סניף</span>
          <span class="field-label">בנק</span>
        </div>

        <div class="input-row five-cols-equal">
          <div class="input-col-plain">
            <input 
              pInputText 
              type="text" 
              [(ngModel)]="formData.amount"
              placeholder="מה מספר" />
          </div>
          
          <div class="input-col-plain">
            <input 
              pInputText 
              type="text" 
              [(ngModel)]="formData.asmachta"
              placeholder="מה מספר" />
          </div>

          <div class="input-col-plain">
            <input 
              pInputText 
              type="text" 
              [(ngModel)]="formData.accountNumber"
              placeholder="מה מספר" />
          </div>

          <div class="input-col-plain">
            <input 
              pInputText 
              type="text" 
              [(ngModel)]="formData.branchNumber"
              placeholder="מה מספר" />
          </div>
          
          <div class="input-col-plain">
            <p-dropdown 
              [(ngModel)]="formData.bank"
              [options]="bankOptions" 
              placeholder="אוצר החייל"
              [showClear]="false">
            </p-dropdown>
          </div>
        </div>

        <button 
          pButton 
          type="button" 
          label="הוספת שורה"
          class="save-line-btn"
          (click)="saveTransferLine()">
        </button>
      </div>

      <div class="line-divider"></div>

      <!-- Section 3: Added Payments -->
      <div class="section-block added-payments-section">
        <div class="header-row">
          <h3 class="section-title">העברה בנקאית</h3>
        </div>

        <!-- Transfer Item -->
        <div class="payment-item" *ngFor="let transfer of transfers; let i = index">
          <div class="payment-row">
            <div class="payment-actions">
              <button class="icon-btn delete-btn" (click)="deleteTransfer(i)">
                <i class="pi pi-trash"></i>
              </button>
              <button class="icon-btn edit-btn" (click)="editTransfer(i)">
                <i class="pi pi-pencil"></i>
              </button>
            </div>
            <div class="payment-details">
              <div class="detail-item">
                <span class="detail-value">{{transfer.amount}}₪</span>
                <span class="detail-label">סכום:</span>
              </div>
              <div class="detail-item">
                <span class="detail-value">{{transfer.asmachta}}</span>
                <span class="detail-label">אסמכתא:</span>
              </div>
              <div class="detail-item">
                <span class="detail-value">{{transfer.accountNumber}}</span>
                <span class="detail-label">מספר חשבון:</span>
              </div>
              <div class="detail-item">
                <span class="detail-value">{{transfer.branchNumber}}</span>
                <span class="detail-label">מספר סניף:</span>
              </div>
              <div class="detail-item">
                <span class="detail-value">{{transfer.bank}}</span>
                <span class="detail-label">בנק:</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Check Item -->
        <div class="payment-item check-item" *ngFor="let check of checks; let i = index">
          <div class="payment-row">
            <div class="payment-actions">
              <button class="icon-btn delete-btn" (click)="deleteCheck(i)">
                <i class="pi pi-trash"></i>
              </button>
              <button class="icon-btn edit-btn" (click)="editCheck(i)">
                <i class="pi pi-pencil"></i>
              </button>
            </div>
            <div class="payment-details check-details">
              <div class="detail-item">
                <span class="detail-label">סכום:</span>
                <span class="detail-value">{{check.amount}}₪</span>
                
              </div>
              <div class="detail-item">
                <span class="detail-label">תאריך פרעון:</span>
                <span class="detail-value">{{check.dueDate}}</span>
                
              </div>
              <div class="detail-item">
                <span class="detail-label">מספר שיק:</span>
                <span class="detail-value">{{check.checkNumber}}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">מספר סניף:</span>
                <span class="detail-value">{{check.branchNumber}}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">בנק:</span>
                <span class="detail-value">{{check.bank}}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Total Display -->
        <div class="total-display">
          <span class="total-label">סה״כ</span>
          <span class="total-value">{{totalAmount}}₪</span>
        </div>
      </div>

      <div class="line-divider"></div>

      <!-- Notes -->
      <div class="section-block notes-section">
        <div class="header-row">
          <h3 class="section-title">הערות</h3>
        </div>

        <div class="input-row">
          <div class="input-col full">
            <span class="input-label">הערות נוספות</span>
            <textarea 
              pInputText 
              [(ngModel)]="formData.notes"
              placeholder="הכנס הערות נוספות"
              rows="2"></textarea>
          </div>
        </div>
      </div>

      <button 
        pButton 
        label="שמור תשלום"
        class="final-save-btn"
        (click)="onSubmit()">
      </button>
    </div>

    <!-- Right Side - Illustration -->
    <div class="illustration-side">
      <div class="image-overlay">
        <img src="assets/images/payments_modal.png" alt="תשלום חדש" />
        <h2>תשלום חדש</h2>
      </div>
    </div>
  </div>
</p-dialog>

<!-- MOBILE VIEW - FULLSCREEN NO DIALOG -->
<div class="mobile-form-container" *ngIf="isMobile && visible">
  <!-- Mobile Header with Image -->
  <div class="mobile-form-image">
    <img src="assets/images/payments_modal.png" alt="תשלום חדש">
    <button class="mobile-back-btn" (click)="closeDialog()">
      <span class="back-arrow">&lt;</span>
    </button>
    <h2>תשלום חדש</h2>
  </div>

  <!-- Mobile Form Content -->
  <div class="mobile-form-content">
    <!-- Payment Method & Date -->
    <div class="mobile-section-title">פרטי התשלום</div>
    
    <div class="mobile-field-group">
      <label>אמצעי תשלום</label>
      <p-dropdown 
        [(ngModel)]="formData.paymentMethod"
        [options]="paymentMethodOptions" 
        placeholder="בחר אמצעי תשלום"
        [showClear]="true">
      </p-dropdown>
    </div>

    <div class="mobile-field-group">
      <label>תאריך תשלום</label>
      <p-calendar 
        [(ngModel)]="formData.paymentDate" 
        dateFormat="dd/mm/yy"
        [showIcon]="true"
        placeholder="—/—/—">
      </p-calendar>
    </div>

    <button 
      pButton 
      type="button" 
      label="+ הוסף תשלום"
      class="mobile-add-method-btn"
      (click)="addPaymentMethod()">
    </button>

    <div style="height: 1px; border-top: 1px solid #B8B3FD; margin: 16px 0; width: 100%;"></div>

    <!-- Bank Details -->
    <div class="mobile-section-title">פרטי ההעברה</div>

    <div class="mobile-field-group">
      <label>בנק</label>
      <p-dropdown 
        [(ngModel)]="formData.bank"
        [options]="bankOptions" 
        placeholder="בחר בנק"
        [showClear]="true">
      </p-dropdown>
    </div>

    <div class="mobile-field-group">
      <label>מספר סניף</label>
      <input 
        pInputText 
        type="text" 
        [(ngModel)]="formData.branchNumber"
        placeholder="מספר סניף" />
    </div>

    <div class="mobile-field-group">
      <label>מספר חשבון</label>
      <input 
        pInputText 
        type="text" 
        [(ngModel)]="formData.accountNumber"
        placeholder="מספר חשבון" />
    </div>

    <div class="mobile-two-cols">
      <div class="mobile-field-group">
        <label>אסמכתא</label>
        <input 
          pInputText 
          type="text" 
          [(ngModel)]="formData.asmachta"
          placeholder="אסמכתא" />
      </div>

      <div class="mobile-field-group">
        <label>סכום</label>
        <input 
          pInputText 
          type="number" 
          [(ngModel)]="formData.amount"
          placeholder="0.00"
          step="0.01" />
      </div>
    </div>

    <button 
      pButton 
      type="button" 
      label="הוספת שורה"
      class="mobile-save-line-btn"
      (click)="saveTransferLine()">
    </button>

    <div style="height: 1px; border-top: 1px solid #B8B3FD; margin: 16px 0; width: 100%;"></div>

    <!-- Added Payments -->
    <div class="mobile-section-title">התשלומים שנוספו</div>

    <div class="mobile-transfer-item" *ngFor="let transfer of transfers; let i = index">
      <div class="mobile-transfer-content">
        <div class="mobile-transfer-row">
          <span class="field-label">בנק:</span>
          <span class="field-value">{{transfer.bank}}</span>
        </div>
        <div class="mobile-transfer-row">
          <span class="field-label">מספר סניף:</span>
          <span class="field-value">{{transfer.branchNumber}}</span>
        </div>
        <div class="mobile-transfer-row">
          <span class="field-label">חשבון:</span>
          <span class="field-value">{{transfer.accountNumber}}</span>
        </div>
        <div class="mobile-transfer-row">
          <span class="field-label">אסמכתא:</span>
          <span class="field-value">{{transfer.asmachta}}</span>
        </div>
        <div class="mobile-transfer-row">
          <span class="field-label">סכום:</span>
          <span class="field-value">{{transfer.amount}}₪</span>
        </div>
      </div>
      <div class="mobile-transfer-actions">
        <button class="icon-btn edit-btn" (click)="editTransfer(i)">
          <i class="pi pi-pencil"></i>
        </button>
        <button class="icon-btn delete-btn" (click)="deleteTransfer(i)">
          <i class="pi pi-trash"></i>
        </button>
      </div>
    </div>

    <!-- Check Items -->
    <div class="mobile-transfer-item" *ngFor="let check of checks; let i = index">
      <div class="mobile-transfer-content">
        <div class="mobile-transfer-row">
          <span class="field-label">בנק:</span>
          <span class="field-value">{{check.bank}}</span>
        </div>
        <div class="mobile-transfer-row">
          <span class="field-label">מספר סניף:</span>
          <span class="field-value">{{check.branchNumber}}</span>
        </div>
        <div class="mobile-transfer-row">
          <span class="field-label">מספר שיק:</span>
          <span class="field-value">{{check.checkNumber}}</span>
        </div>
        <div class="mobile-transfer-row">
          <span class="field-label">תאריך פרעון:</span>
          <span class="field-value">{{check.dueDate}}</span>
        </div>
        <div class="mobile-transfer-row">
          <span class="field-label">סכום:</span>
          <span class="field-value">{{check.amount}}₪</span>
        </div>
      </div>
      <div class="mobile-transfer-actions">
        <button class="icon-btn edit-btn" (click)="editCheck(i)">
          <i class="pi pi-pencil"></i>
        </button>
        <button class="icon-btn delete-btn" (click)="deleteCheck(i)">
          <i class="pi pi-trash"></i>
        </button>
      </div>
    </div>

    <!-- Total Display -->
    <div class="mobile-total-display">
      <span class="total-label">סה״כ</span>
      <span class="total-value">{{totalAmount}}₪</span>
    </div>

    <div style="height: 1px; border-top: 1px solid #B8B3FD; margin: 16px 0; width: 100%;"></div>

    <!-- Notes -->
    <div class="mobile-section-title">הערות</div>

    <div class="mobile-field-group">
      <label>הערות נוספות</label>
      <textarea 
        pInputText 
        [(ngModel)]="formData.notes"
        placeholder="הכנס הערות נוספות"
        rows="3"></textarea>
    </div>
  </div>

  <!-- Mobile Save Button -->
  <div class="mobile-form-actions">
    <button 
      pButton 
      label="שמור תשלום"
      class="mobile-save-button" 
      (click)="onSubmit()">
    </button>
  </div>
</div>